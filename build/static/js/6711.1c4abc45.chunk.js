"use strict";(self.webpackChunkgithubit_dashboard=self.webpackChunkgithubit_dashboard||[]).push([[6711],{14386:(e,t,a)=>{a.r(t),a.d(t,{default:()=>M});var r=a(9950),n=a(25887),l=a(85657),d=a(48538),i=a(87094),s=a(41988),o=(a(59690),a(51235)),c=a(93149),u=a(37980),y=a(45515),p=a(91854),m=a(57056),v=a(59051),h=a.n(v),_=a(51242),f=a(28429),b=a(74623),x=a(53177),j=a(92270),g=a(70030),A=a(96011),k=a.n(A),S=a(27741),N=a(44269),C=a(65604),B=a(49348),D=a(81446),P=a(44414);function T(e){let{handleCancel:t,handleSave:a}=e;const l=(0,C.useStripe)(),i=(0,C.useElements)(),{t:s}=(0,g.B)(),[o]=n.A.useForm(),[c,u]=(0,r.useState)(!1),{data:y}=(0,p.d4)((e=>e.order),p.bN),{orderData:m}=(0,p.d4)((e=>e.order),p.bN);return(0,P.jsx)(P.Fragment,{children:c?(0,P.jsx)(D.A,{}):(0,P.jsxs)(n.A,{layout:"vertical",name:"stripe",form:o,children:[(0,P.jsx)(n.A.Item,{name:"stripe",label:s("stripe"),rules:[{required:!0,message:s("required")}],children:(0,P.jsx)(C.PaymentElement,{})}),(0,P.jsxs)("div",{className:"d-flex justify-content-end mt-5",children:[(0,P.jsx)(d.A,{type:"primary",htmlType:"submit",className:"mr-3",onClick:async()=>{var e;const t={payment_sys_id:y.paymentType.value};if(!l||!i)return;const r=await l.confirmPayment({elements:i,confirmParams:{return_url:"http://localhost:3000/payment-result"},redirect:"if_required"});"succeeded"===(null===(e=r.paymentIntent)||void 0===e?void 0:e.status)?function(e,t){j.A.create(e,t).then((e=>a(e.data.id))).finally((()=>u(!1)))}(m.id,t):r.error?B.oR.error(r.error.message):console.log(r.error.message)},disabled:!l,children:s("submit")}),(0,P.jsx)(d.A,{onClick:t,children:s("cancel")})]})]})})}var F=a(83712),O=a(63620);const w=function(e){let{handleSave:t,client_key:a}=e;const{data:r}=(0,p.d4)((e=>e.order),p.bN),{orderData:n}=(0,p.d4)((e=>e.order),p.bN),l={payment_sys_id:r.paymentType.value};return null!==n&&void 0!==n&&n.price?(0,P.jsx)(F.ag,{options:{"client-id":a.client_id||O.Ch,currency:"USD"},children:(0,P.jsx)(F.JV,{createOrder:(e,t)=>t.order.create({purchase_units:[{amount:{value:`${null===n||void 0===n?void 0:n.price}`}}]}),onApprove:(e,a)=>a.order.capture().then((()=>{!function(e,a){j.A.create(e,a).then((e=>t(e.data.id)))}(n.id,l)}))})}):""};var J=a(86552);const Y=function(e){let{handleSave:t,handleClose:a,client_key:r}=e;const{t:n}=(0,g.B)(),{data:l}=(0,p.d4)((e=>e.order),p.bN),{orderData:i}=(0,p.d4)((e=>e.order),p.bN),s={payment_sys_id:l.paymentType.value},o=()=>function(e,a){j.A.create(e,a).then((e=>t(e.data.id)))}(i.id,s),c={...{reference:(new Date).getTime().toString(),email:l.userOBJ.email,amount:100*parseFloat(null===i||void 0===i?void 0:i.price),publicKey:(null===r||void 0===r?void 0:r.client_id)||O.lL,currency:"ZAR",order_id:null===i||void 0===i?void 0:i.id},text:"Paystack Button Implementation",onSuccess:e=>o(),onClose:a};return(0,P.jsx)(P.Fragment,{children:0!==Object.keys(i).length&&(0,P.jsx)(J.V$,{...c,children:e=>{let{initializePayment:t}=e;return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsxs)("p",{children:[n("total.amount"),": ",i.price]}),(0,P.jsx)(d.A,{className:"d-flex justify-content-end",onClick:()=>t(o,a),children:n("paystack")})]})}})})};var $=a(75520),I=a.n($);const q=e=>{let{handleSave:t,client_key:a}=e;const{t:n}=(0,g.B)(),{data:l}=(0,p.d4)((e=>e.order),p.bN),{orderData:i}=(0,p.d4)((e=>e.order),p.bN),s=I()();const o={payment_sys_id:l.paymentType.value},c=(0,r.useCallback)((async()=>{var e,r,n,d,c,u,y;const{data:p}=await k().post(O.fB,{amount:null===i||void 0===i?void 0:i.price}),m={key:(null===a||void 0===a?void 0:a.client_id)||O.ne,amount:null===i||void 0===i?void 0:i.price,currency:"INR",name:`${null===(e=l.userOBJ)||void 0===e?void 0:e.firstname} ${null===(r=l.userOBJ)||void 0===r?void 0:r.lastname}`,description:"Transaction",image:"https://example.com/your_logo",order_id:p.order.id,handler:e=>function(e,a){j.A.create(e,a).then((e=>t(e.data.id)))}(i.id,o),prefill:{name:`${null===(n=l.userOBJ)||void 0===n?void 0:n.firstname} ${null===(d=l.userOBJ)||void 0===d?void 0:d.lastname}`,email:null===(c=l.userOBJ)||void 0===c?void 0:c.email,contact:null===(u=l.userOBJ)||void 0===u?void 0:u.phone},notes:{address:null===(y=l.address)||void 0===y?void 0:y.label},theme:{color:"#3399cc"}};new s(m).open()}));return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsxs)("p",{children:[n("total.amount"),": ",i.price]}),(0,P.jsx)(d.A,{className:"btn btn-dark",onClick:c,children:n("razorpay")})]})},z=e=>{var t,a;let{visibility:r,handleCancel:n,handleSave:l}=e;const{data:d,paymentData:i}=(0,p.d4)((e=>e.order),p.bN),{t:s}=(0,g.B)(),o=O.eQ,c=(0,N.c)(o),u={clientSecret:null===(t=r.stripe)||void 0===t||null===(a=t.paymentIntent)||void 0===a?void 0:a.client_secret};return(0,P.jsxs)(S.A,{visible:r,title:s("create.payment"),className:"large-modal",footer:!1,onCancel:n,children:["Paypal"===d.paymentType.label&&r.paypal&&(0,P.jsx)(w,{handleSave:l,client_key:i}),"Paystack"===d.paymentType.label&&r.paystack&&(0,P.jsx)(Y,{handleSave:l,handleCancel:n,client_key:i}),"Razorpay"===d.paymentType.label&&r.razorpay&&(0,P.jsx)(q,{handleSave:l,client_key:i}),"Stripe"===d.paymentType.label&&r.stripe&&(0,P.jsx)(C.Elements,{stripe:c,options:u,children:(0,P.jsx)(T,{handleCancel:n,handleSave:l})})]})};var E=a(76214);function M(){const{t:e}=(0,g.B)(),[t]=n.A.useForm(),a=(0,p.wA)(),v=(0,f.Zp)(),[A,S]=(0,r.useState)(null),{myShop:N}=(0,p.d4)((e=>e.myShop),p.bN),[C,B]=(0,r.useState)(!1),[D,T]=(0,r.useState)(null),{orderProducts:F,data:w,total:J,coupon:Y}=(0,p.d4)((e=>e.order),p.bN),{delivery:$}=(0,p.d4)((e=>e.globalSettings.settings),p.bN),{activeMenu:I}=(0,p.d4)((e=>e.menu),p.bN),{currencies:q}=(0,p.d4)((e=>e.currency),p.bN);(0,r.useEffect)((()=>()=>{const e=t.getFieldsValue(!0);console.log("formData => ",e);const r={...e,delivery_date:e.delivery_date?h()(e.delivery_date).format("YYYY-MM-DD"):void 0};a((0,_.B_)(r))}),[]),(0,r.useEffect)((()=>{if(I.refetch){const e=q.find((e=>e.default));a((0,_._9)(e)),t.setFieldsValue({currency_id:e.id}),a((0,b.km)(I))}}),[I.refetch]);const M=(e,t)=>{const r={payment_sys_id:t.value};B(!0),m.A.create(e).then((e=>{a((0,_.lw)(e.data)),"Stripe"===t.label?(e=>{var t;"Stripe"===w.paymentType.label&&null!==(t=Object.keys(e))&&void 0!==t&&t.length&&k().post(O.qA,{amount:e.price,order_id:e.id}).then((e=>{S({stripe:e.data})})).catch((e=>console.log(e)))})(e.data):"Paypal"===t.label?S({paypal:e.data}):"Paystack"===t.label?S({paystack:e.data}):"Razorpay"===t.label?S({razorpay:e.data}):function(e,t){j.A.create(e,t).then((e=>{T(e.data.id),a((0,_.Uy)())})).finally((()=>B(!1)))}(e.data.id,r)})).catch((()=>B(!1)))};return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(l.A,{title:e("new.order"),extra:(0,P.jsx)(d.A,{type:"primary",loading:C,onClick:()=>t.submit(),disabled:!F.length,children:e("create")})}),(0,P.jsxs)(n.A,{name:"order-form",form:t,layout:"vertical",onFinish:e=>{var t,a;console.log("values => ",e);const r=w.delivery_fee+J.order_total,n={user_id:null===(t=e.user)||void 0===t?void 0:t.value,total:r,currency_id:e.currency_id,rate:null===(a=q.find((t=>t.id===e.currency_id)))||void 0===a?void 0:a.rate,shop_id:N.id,delivery_id:e.delivery.value,delivery_fee:w.delivery_fee,coupon:Y.coupon,tax:J.order_tax,commission_fee:1,payment_type:e.payment_type.value,delivery_time:e.delivery_time,note:e.note,delivery_date:h()(e.delivery_date).format("YYYY-MM-DD"),delivery_address_id:e.address.value,delivery_type_id:e.delivery.value,total_discount:F.reduce(((e,t)=>e+t.discount),0),products:F.map((e=>({shop_product_id:e.id,price:e.price,qty:e.qty,tax:e.tax,discount:e.discount,total_price:e.total_price})))};console.log("body => ",n),M(n,e.payment_type)},className:"order-add",initialValues:{user:w.user||null,address:w.address||null,currency_id:w.currency.id,payment_type:w.payment_type||null,delivery_date:h()(w.delivery_date)||null,delivery:w.delivery||null,delivery_time:w.delivery_time||null},children:[(0,P.jsxs)(i.A,{gutter:24,children:[(0,P.jsx)(s.A,{span:16,children:(0,P.jsx)(u.A,{form:t})}),(0,P.jsxs)(s.A,{span:8,children:[(0,P.jsx)(o.A,{form:t,fetchPaypal:e=>{const t=e.value;E.A.getById(t,{}).then((e=>a((0,_.$O)(e.data))))}}),(0,P.jsx)(c.A,{form:t})]})]}),D?(0,P.jsx)(y.A,{orderId:D,handleClose:()=>{T(null);const e="seller/orders";a((0,b.EK)({...I,nextUrl:e})),v(`/${e}`),a((0,x.PL)())}}):"",A&&(0,P.jsx)(z,{visibility:A,handleCancel:()=>S(null),handleSave:e=>{T(e),S(null),a((0,_.Uy)())}})]})]})}}}]);