"use strict";(self.webpackChunkgithubit_dashboard=self.webpackChunkgithubit_dashboard||[]).push([[9776],{96235:(e,a,t)=>{t.r(a),t.d(a,{default:()=>V});var r=t(9950),l=t(25887),n=t(85657),d=t(48538),i=t(87094),s=t(41988),o=t(90650),c=(t(59690),t(51235)),u=t(93149),y=t(37980),p=t(45515),v=t(91854),m=t(59051),h=t.n(m),_=t(51242),b=t(28429),f=t(74623),x=t(53177),j=t(70030),g=t(92270),A=t(57056),S=t(96011),k=t.n(S),N=t(27741),C=t(44269),B=t(65604),P=t(49348),F=t(81446),O=t(44414);function T(e){let{handleCancel:a,handleSave:t}=e;const n=(0,B.useStripe)(),i=(0,B.useElements)(),{t:s}=(0,j.B)(),[o]=l.A.useForm(),[c,u]=(0,r.useState)(!1),{data:y}=(0,v.d4)((e=>e.order),v.bN),{orderData:p}=(0,v.d4)((e=>e.order),v.bN);return(0,O.jsx)(O.Fragment,{children:c?(0,O.jsx)(F.A,{}):(0,O.jsxs)(l.A,{layout:"vertical",name:"stripe",form:o,children:[(0,O.jsx)(l.A.Item,{name:"stripe",label:s("stripe"),rules:[{required:!0,message:s("required")}],children:(0,O.jsx)(B.PaymentElement,{})}),(0,O.jsxs)("div",{className:"d-flex justify-content-end mt-5",children:[(0,O.jsx)(d.A,{type:"primary",htmlType:"submit",className:"mr-3",onClick:async()=>{var e;const a={payment_sys_id:y.paymentType.value};if(!n||!i)return;const r=await n.confirmPayment({elements:i,confirmParams:{return_url:"http://localhost:3000/payment-result"},redirect:"if_required"});"succeeded"===(null===(e=r.paymentIntent)||void 0===e?void 0:e.status)?function(e,a){g.A.create(e,a).then((e=>t(e.data.id))).finally((()=>u(!1)))}(p.id,a):r.error?P.oR.error(r.error.message):console.log(r.error.message)},disabled:!n,children:s("submit")}),(0,O.jsx)(d.A,{onClick:a,children:s("cancel")})]})]})})}var D=t(83712),q=t(63620);const w=function(e){let{handleSave:a,client_key:t}=e;const{data:r}=(0,v.d4)((e=>e.order),v.bN),{orderData:l}=(0,v.d4)((e=>e.order),v.bN),n={payment_sys_id:r.paymentType.value};return console.log("orderData",l),null!==l&&void 0!==l&&l.price?(0,O.jsx)(D.ag,{options:{"client-id":t.client_id||q.Ch,currency:"USD"},children:(0,O.jsx)(D.JV,{createOrder:(e,a)=>a.order.create({purchase_units:[{amount:{value:`${null===l||void 0===l?void 0:l.price}`}}]}),onApprove:(e,t)=>t.order.capture().then((()=>{!function(e,t){g.A.create(e,t).then((e=>a(e.data.id)))}(l.id,n)}))})}):""};var I=t(86552);const J=function(e){var a;let{handleSave:t,handleClose:r}=e;const{t:l}=(0,j.B)(),{data:n}=(0,v.d4)((e=>e.order),v.bN),{orderData:i}=(0,v.d4)((e=>e.order),v.bN),s={payment_sys_id:n.paymentType.value},o=()=>function(e,a){g.A.create(e,a).then((e=>t(e.data.id)))}(i.id,s),c={...{reference:(new Date).getTime().toString(),email:null===n||void 0===n||null===(a=n.userOBJ)||void 0===a?void 0:a.email,amount:100*parseFloat(null===i||void 0===i?void 0:i.price),publicKey:q.lL,currency:"ZAR",order_id:null===i||void 0===i?void 0:i.id},text:"Paystack Button Implementation",onSuccess:e=>o(),onClose:r};return(0,O.jsx)(O.Fragment,{children:0!==Object.keys(i).length&&(0,O.jsx)(I.V$,{...c,children:e=>{let{initializePayment:a}=e;return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)("p",{children:[l("total.amount"),": ",i.price]}),(0,O.jsx)(d.A,{className:"d-flex justify-content-end",onClick:()=>a(o,r),children:l("paystack")})]})}})})};var $=t(75520),z=t.n($);const E=e=>{let{handleSave:a}=e;const{t:t}=(0,j.B)(),{data:l}=(0,v.d4)((e=>e.order),v.bN),{orderData:n}=(0,v.d4)((e=>e.order),v.bN),i=z()();const s={payment_sys_id:l.paymentType.value},o=(0,r.useCallback)((async()=>{var e,t,r,d,o,c,u;const{data:y}=await k().post(q.fB,{amount:null===n||void 0===n?void 0:n.price}),p={key:q.ne,amount:null===n||void 0===n?void 0:n.price,currency:"INR",name:`${null===(e=l.userOBJ)||void 0===e?void 0:e.firstname} ${null===(t=l.userOBJ)||void 0===t?void 0:t.lastname}`,description:"Transaction",image:"https://example.com/your_logo",order_id:y.order.id,handler:e=>{console.log(e),function(e,t){g.A.create(e,t).then((e=>a(e.data.id)))}(n.id,s)},prefill:{name:`${null===(r=l.userOBJ)||void 0===r?void 0:r.firstname} ${null===(d=l.userOBJ)||void 0===d?void 0:d.lastname}`,email:null===(o=l.userOBJ)||void 0===o?void 0:o.email,contact:null===(c=l.userOBJ)||void 0===c?void 0:c.phone},notes:{address:null===(u=l.address)||void 0===u?void 0:u.label},theme:{color:"#3399cc"}};new i(p).open()}));return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)("p",{children:[t("total.amount"),": ",n.price]}),(0,O.jsx)(d.A,{className:"btn btn-dark",onClick:o,children:t("razorpay")})]})},R=q.eQ,U=e=>{var a,t;let{visibility:r,handleCancel:l,handleSave:n}=e;const{t:d}=(0,j.B)(),i=(0,C.c)(R),s={clientSecret:null===(a=r.stripe)||void 0===a||null===(t=a.paymentIntent)||void 0===t?void 0:t.client_secret},{data:o}=(0,v.d4)((e=>e.order),v.bN);return(0,O.jsxs)(N.A,{visible:r,title:d("create.payment"),className:"large-modal",footer:!1,onCancel:l,children:["Paypal"===o.paymentType.label&&r.paypal&&(0,O.jsx)(w,{handleSave:n}),"Paystack"===o.paymentType.label&&r.paystack&&(0,O.jsx)(J,{handleSave:n,handleCancel:l}),"Razorpay"===o.paymentType.label&&r.razorpay&&(0,O.jsx)(E,{handleSave:n}),"Stripe"===o.paymentType.label&&r.stripe&&(0,O.jsx)(B.Elements,{stripe:i,options:s,children:(0,O.jsx)(T,{handleCancel:l,handleSave:n})})]})};var M=t(76214);function V(){const{t:e}=(0,j.B)(),[a]=l.A.useForm(),t=(0,v.wA)(),{id:m}=(0,b.g)(),S=(0,b.Zp)(),[N,C]=(0,r.useState)(!1),[B,P]=(0,r.useState)(null),[F,T]=(0,r.useState)(!1),{myShop:D}=(0,v.d4)((e=>e.myShop),v.bN),[w,I]=(0,r.useState)(null),{currencies:J}=(0,v.d4)((e=>e.currency),v.bN),{activeMenu:$}=(0,v.d4)((e=>e.menu),v.bN),{payments:z}=(0,v.d4)((e=>e.payment),v.bN),{data:E,total:R,coupon:V,orderProducts:Y}=(0,v.d4)((e=>e.order),v.bN);const K=e=>{var a;console.log("createdOrderData",e),"Stripe"===E.paymentType.label&&null!==(a=Object.keys(e))&&void 0!==a&&a.length&&k().post(q.qA,{amount:e.price,order_id:e.id}).then((e=>{I({stripe:e.data})})).catch((e=>console.log(e)))},L=(e,r)=>{const l={payment_sys_id:r.value};C(!0),A.A.update(m,e).then((e=>{t((0,_.lw)(e.data)),"Stripe"===r.label?K(e.data):"Paypal"===r.label?I({paypal:e.data}):"Paystack"===r.label?I({paystack:e.data}):"Razorpay"===r.label?I({razorpay:e.data}):function(e,r){g.A.create(e,r).then((e=>{P(e.data.id),t((0,_.Uy)()),a.resetFields()})).finally((()=>C(!1)))}(e.data.id,l)})).catch((()=>C(!1)))};(0,r.useEffect)((()=>{$.refetch&&(T(!0),A.A.getById(m).then((e=>{var r,l,n,d,i,s;const o=e.data;console.log("order data => ",o);const c=o.details.flatMap((e=>({...e.shopProduct,quantity:e.quantity,img:e.shopProduct.product.img})));var u;t((0,_._9)(o.currency)),t((0,_.F1)(c)),t((0,_.B_)({userUuid:o.user.uuid,delivery_time:o.delivery_time,delivery_fee:o.delivery_fee,user:o.user})),a.setFieldsValue({delivery_time:(null===E||void 0===E?void 0:E.delivery_time)||"9:00-10:00",user:(u=o.user,{label:u.firstname+" "+u.lastname,value:u.id,uuid:u.uuid}),currency_id:o.currency.id,address:{label:null===o||void 0===o||null===(r=o.delivery_address)||void 0===r?void 0:r.address,value:null===o||void 0===o||null===(l=o.delivery_address)||void 0===l?void 0:l.id},payment_type:{label:null===(n=o.transaction)||void 0===n||null===(d=n.payment_system.translation)||void 0===d?void 0:d.title,value:null===(i=o.transaction)||void 0===i?void 0:i.payment_system.id},note:o.note,delivery_date:h()(E.delivery_date),delivery:{label:null===(s=o.delivery_type.translation)||void 0===s?void 0:s.title,value:o.delivery_type.id}})})).finally((()=>{T(!1),t((0,f.km)($))})))}),[$.refetch]);return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(n.A,{title:e("edit.order"),extra:(0,O.jsx)(d.A,{type:"primary",loading:N,onClick:()=>a.submit(),disabled:!(null!==Y&&void 0!==Y&&Y.length),children:e("save")})}),(0,O.jsxs)(l.A,{name:"order-form",form:a,layout:"vertical",onFinish:e=>{var a,t;console.log("values => ",e);const r=E.delivery_fee+R.order_total,l={user_id:null===(a=e.user)||void 0===a?void 0:a.value,total:r,currency_id:e.currency_id,rate:null===(t=J.find((a=>a.id===e.currency_id)))||void 0===t?void 0:t.rate,shop_id:D.id,delivery_id:e.delivery.value,delivery_fee:E.delivery_fee,coupon:V.coupon,tax:R.order_tax,commission_fee:1,payment_type:e.payment_type.value,delivery_time:e.delivery_time,note:e.note,delivery_date:h()(e.delivery_date).format("YYYY-MM-DD"),delivery_address_id:e.address.value,delivery_type_id:e.delivery.value,total_discount:Y.reduce(((e,a)=>e+a.discount),0),products:Y.map((e=>({shop_product_id:e.id,price:e.price,qty:e.qty,tax:e.tax,discount:e.discount,total_price:e.total_price})))};console.log("body => ",l),L(l,e.payment_type)},className:"order-add",initialValues:{user:E.user||null,address:E.address||null,currency_id:E.currency.id,payment_type:E.payment_type||null},children:[(0,O.jsxs)(i.A,{gutter:24,hidden:F,children:[(0,O.jsx)(s.A,{span:16,children:(0,O.jsx)(y.A,{form:a})}),(0,O.jsxs)(s.A,{span:8,children:[(0,O.jsx)(c.A,{form:a,fetchPaypal:e=>{const a=e.value;M.A.getById(a,{}).then((e=>t((0,_.$O)(e.data))))}}),(0,O.jsx)(u.A,{form:a})]})]}),F&&(0,O.jsx)("div",{className:"loader",children:(0,O.jsx)(o.A,{})})]}),B?(0,O.jsx)(p.A,{orderId:B,handleClose:()=>{P(null);const e="seller/orders";t((0,f.EK)({...$,nextUrl:e})),S(`/${e}`),t((0,x.PL)())}}):"",w&&(0,O.jsx)(U,{visibility:w,handleCancel:()=>I(null),handleSave:e=>{P(e),I(null),t((0,_.Uy)())},payments:z})]})}}}]);